<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>libclo by fredrikwidlund</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">libclo</h1>
      <h2 class="project-tagline">Compound literal JSON objects</h2>
      <a href="https://github.com/fredrikwidlund/libclo" class="btn">View on GitHub</a>
      <a href="https://github.com/fredrikwidlund/libclo/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/fredrikwidlund/libclo/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h1>
<a id="libclo" class="anchor" href="#libclo" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>libclo</h1>

<p>Compound literal JSON objects</p>

<h2>
<a id="description" class="anchor" href="#description" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Description</h2>

<p>libclo is a C library with the single purpose of emitting serialized JSON structures in a high performance environment, while correctly handling escaping, control characters and UTF-8 encoding. This can be useful for example when using JSON for log formats, or when building RESTful services.</p>

<p>It does this by constructing the JSON structures as compound literals, which does not require any runtime memory allocation or system calls.</p>

<h2>
<a id="performance" class="anchor" href="#performance" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Performance</h2>

<p><a href="https://github.com/fredrikwidlund/libclo_benchmark">Simple JSON serialization benchmark</a></p>

<table>
<thead>
<tr>
<th>Library</th>
<th>Performance</th>
<th>Factor</th>
</tr>
</thead>
<tbody>
<tr>
<td>libclo</td>
<td>378.94 ns</td>
<td>1.0x</td>
</tr>
<tr>
<td>jansson</td>
<td>2463.8 ns</td>
<td>6.5x</td>
</tr>
<tr>
<td>cJSON</td>
<td>1693.1 ns</td>
<td>4.5x</td>
</tr>
</tbody>
</table>

<p>libclo is a small subset though of the functionality in cJSON, and even more so of the functionality in jansson.</p>

<h2>
<a id="installation" class="anchor" href="#installation" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Installation</h2>

<pre><code>$ git clone https://github.com/fredrikwidlund/libclo.git
$ cd libclo
$ ./autogen.sh
$ ./configure
$ make install
</code></pre>

<h2>
<a id="test" class="anchor" href="#test" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Test</h2>

<p>Tests require 100% code coverage to succeed.</p>

<pre><code>$ make check
[...]
$ cat test/coverage.sh.log 
[clo]
File 'src/clo.c'
Lines executed:100.00% of 95
Branches executed:100.00% of 50
Taken at least once:100.00% of 50
Calls executed:100.00% of 28
PASS test/coverage.sh (exit status: 0)
</code></pre>

<h2>
<a id="usage" class="anchor" href="#usage" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Usage</h2>

<h3>
<a id="hello-world" class="anchor" href="#hello-world" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Hello world</h3>

<div class="highlight highlight-source-c"><pre>$ cat hello.c
#<span class="pl-k">include</span> <span class="pl-s"><span class="pl-pds">&lt;</span>stdio.h<span class="pl-pds">&gt;</span></span>
#<span class="pl-k">include</span> <span class="pl-s"><span class="pl-pds">&lt;</span>stdlib.h<span class="pl-pds">&gt;</span></span>
#<span class="pl-k">include</span> <span class="pl-s"><span class="pl-pds">&lt;</span>stdint.h<span class="pl-pds">&gt;</span></span>
#<span class="pl-k">include</span> <span class="pl-s"><span class="pl-pds">&lt;</span>clo.h<span class="pl-pds">&gt;</span></span>

<span class="pl-k">int</span> <span class="pl-en">main</span>()
{
  <span class="pl-k">char</span> string[<span class="pl-c1">256</span>];
  <span class="pl-c1">clo_encode</span>((clo[]){<span class="pl-c1">clo_object</span>({<span class="pl-s"><span class="pl-pds">"</span>hello<span class="pl-pds">"</span></span>, <span class="pl-c1">clo_string</span>(<span class="pl-s"><span class="pl-pds">"</span>world<span class="pl-pds">"</span></span>)})}, string, <span class="pl-k">sizeof</span> string);
  <span class="pl-c1">puts</span>(string);
}
$ gcc -Wall -o hello hello.c -lclo
$ ./hello
{<span class="pl-s"><span class="pl-pds">"</span>hello<span class="pl-pds">"</span></span>:<span class="pl-s"><span class="pl-pds">"</span>world<span class="pl-pds">"</span></span>}</pre></div>

<h3>
<a id="json-types" class="anchor" href="#json-types" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>JSON types</h3>

<div class="highlight highlight-source-c"><pre>$ cat types.c
#<span class="pl-k">include</span> <span class="pl-s"><span class="pl-pds">&lt;</span>stdio.h<span class="pl-pds">&gt;</span></span>
#<span class="pl-k">include</span> <span class="pl-s"><span class="pl-pds">&lt;</span>stdlib.h<span class="pl-pds">&gt;</span></span>
#<span class="pl-k">include</span> <span class="pl-s"><span class="pl-pds">&lt;</span>stdint.h<span class="pl-pds">&gt;</span></span>
#<span class="pl-k">include</span> <span class="pl-s"><span class="pl-pds">&lt;</span>clo.h<span class="pl-pds">&gt;</span></span>

<span class="pl-k">int</span> <span class="pl-en">main</span>()
{
  <span class="pl-k">char</span> buffer[<span class="pl-c1">256</span>];

  clo string = <span class="pl-c1">clo_string</span>(<span class="pl-s"><span class="pl-pds">"</span>unicode snowman - <span class="pl-cce">\xE2\x98\x83</span><span class="pl-pds">"</span></span>);
  clo real = <span class="pl-c1">clo_real</span>(<span class="pl-c1">3.14</span>);
  clo integer = <span class="pl-c1">clo_integer</span>(<span class="pl-c1">42</span>);
  clo <span class="pl-c1">true</span> = <span class="pl-c1">clo_true</span>();
  clo <span class="pl-c1">false</span> = <span class="pl-c1">clo_false</span>();
  clo null = <span class="pl-c1">clo_null</span>();

  clo array = <span class="pl-c1">clo_array</span>(string, real, integer, <span class="pl-c1">true</span>, <span class="pl-c1">false</span>, null);
  <span class="pl-c1">clo_encode</span>(&amp;array, buffer, <span class="pl-k">sizeof</span> buffer);
  <span class="pl-c1">puts</span>(buffer);

  clo object = clo_object
    ({<span class="pl-s"><span class="pl-pds">"</span>string<span class="pl-pds">"</span></span>, string},
     {<span class="pl-s"><span class="pl-pds">"</span>real<span class="pl-pds">"</span></span>, real},
     {<span class="pl-s"><span class="pl-pds">"</span>integer<span class="pl-pds">"</span></span>, integer},
     {<span class="pl-s"><span class="pl-pds">"</span>true<span class="pl-pds">"</span></span>, <span class="pl-c1">true</span>},
     {<span class="pl-s"><span class="pl-pds">"</span>false<span class="pl-pds">"</span></span>, <span class="pl-c1">false</span>},
     {<span class="pl-s"><span class="pl-pds">"</span>null<span class="pl-pds">"</span></span>, null},
     {<span class="pl-s"><span class="pl-pds">"</span>array<span class="pl-pds">"</span></span>, array},
     {<span class="pl-s"><span class="pl-pds">"</span>nested object<span class="pl-pds">"</span></span>, <span class="pl-c1">clo_object</span>({<span class="pl-s"><span class="pl-pds">"</span>object<span class="pl-pds">"</span></span>, <span class="pl-c1">clo_object</span>({<span class="pl-s"><span class="pl-pds">"</span>inner<span class="pl-pds">"</span></span>, <span class="pl-c1">clo_true</span>()})})});
  <span class="pl-c1">clo_encode</span>(&amp;object, buffer, <span class="pl-k">sizeof</span> buffer);
  <span class="pl-c1">puts</span>(buffer);
}
$ gcc -Wall -o types types.c -lclo
$ ./types 
[<span class="pl-s"><span class="pl-pds">"</span>unicode snowman - ☃<span class="pl-pds">"</span></span>,<span class="pl-c1">3.14</span>,<span class="pl-c1">42</span>,<span class="pl-c1">true</span>,<span class="pl-c1">false</span>,null]
{<span class="pl-s"><span class="pl-pds">"</span>string<span class="pl-pds">"</span></span>:<span class="pl-s"><span class="pl-pds">"</span>unicode snowman - ☃<span class="pl-pds">"</span></span>,<span class="pl-s"><span class="pl-pds">"</span>real<span class="pl-pds">"</span></span>:<span class="pl-c1">3.14</span>,<span class="pl-s"><span class="pl-pds">"</span>integer<span class="pl-pds">"</span></span>:<span class="pl-c1">42</span>,<span class="pl-s"><span class="pl-pds">"</span>true<span class="pl-pds">"</span></span>:<span class="pl-c1">true</span>,<span class="pl-s"><span class="pl-pds">"</span>false<span class="pl-pds">"</span></span>:<span class="pl-c1">false</span>,<span class="pl-s"><span class="pl-pds">"</span>null<span class="pl-pds">"</span></span>:null,<span class="pl-s"><span class="pl-pds">"</span>array<span class="pl-pds">"</span></span>:[<span class="pl-s"><span class="pl-pds">"</span>unicode snowman - ☃<span class="pl-pds">"</span></span>,<span class="pl-c1">3.14</span>,<span class="pl-c1">42</span>,<span class="pl-c1">true</span>,<span class="pl-c1">false</span>,null],<span class="pl-s"><span class="pl-pds">"</span>nested object<span class="pl-pds">"</span></span>:{<span class="pl-s"><span class="pl-pds">"</span>object<span class="pl-pds">"</span></span>:{<span class="pl-s"><span class="pl-pds">"</span>inner<span class="pl-pds">"</span></span>:<span class="pl-c1">true</span>}}}</pre></div>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/fredrikwidlund/libclo">libclo</a> is maintained by <a href="https://github.com/fredrikwidlund">fredrikwidlund</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
